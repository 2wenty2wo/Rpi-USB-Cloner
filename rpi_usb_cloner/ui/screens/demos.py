"""Demo screen functions for testing icons and fonts."""

import time
from pathlib import Path
from typing import Iterable, Optional

from PIL import ImageFont

from rpi_usb_cloner.hardware import gpio
from rpi_usb_cloner.ui import display, menus


def _show_icon_font_demo(
    title: str, font_path, *, icons: Optional[Iterable[str]] = None
) -> None:
    context = display.get_display_context()
    title_font = context.fonts.get("title", context.fontdisks)
    content_top = menus.get_standard_content_top(title, title_font=title_font)
    if icons is None:
        icons = ["\uf55a", "\uf060", "\uf30a", "\uf00c"]
    icons = list(icons)
    sizes = [8, 9, 10, 11, 12, 13, 14, 15, 16, 18, 20, 22, 24, 26, 28, 30]
    label_font = context.fontdisks
    icon_font = ImageFont.truetype(font_path, max(sizes))
    max_icon_height = 0
    for glyph in icons:
        bbox = context.draw.textbbox((0, 0), glyph, font=icon_font)
        max_icon_height = max(max_icon_height, bbox[3] - bbox[1])
    label_line_height = display._get_line_height(label_font)
    line_step = max(max_icon_height, label_line_height) + 2
    rows_per_page = max(1, (context.height - content_top - 2) // line_step)
    max_offset = max(0, len(sizes) - rows_per_page)
    scroll_offset = 0

    def render(offset: int) -> int:
        offset = max(0, min(offset, max_offset))
        page_sizes = sizes[offset : offset + rows_per_page]

        draw = context.draw
        draw.rectangle((0, 0, context.width, context.height), outline=0, fill=0)

        # Draw title with icon using proper function
        layout = display.draw_title_with_icon(
            title,
            title_font=title_font,
            icon=chr(0xE24B),  # Sparkles icon
            extra_gap=1,
            left_margin=context.x - 11,
            draw=draw,
        )
        # Update content_top to match the layout
        actual_content_top = layout.content_top

        current_y = actual_content_top
        left_x = context.x - 11
        for size in page_sizes:
            icon_font = ImageFont.truetype(font_path, size)
            icon_height = display._get_line_height(icon_font)
            icon_y = current_y + max(0, (line_step - icon_height) // 2)
            label_y = current_y + max(0, (line_step - label_line_height) // 2)
            label_text = f"{size}px"
            draw.text((left_x, label_y), label_text, font=label_font, fill=255)
            label_width = display._measure_text_width(draw, label_text, label_font)
            current_x = left_x + label_width + 6
            for glyph in icons:
                glyph_width = display._measure_text_width(draw, glyph, icon_font)
                if current_x + glyph_width > context.width - 2:
                    break
                draw.text((current_x, icon_y), glyph, font=icon_font, fill=255)
                current_x += glyph_width + 6
            current_y += line_step

        if len(sizes) > rows_per_page:
            footer_text = "▲▼ to scroll"
            footer_height = display._get_line_height(label_font)
            footer_y = context.height - footer_height - 1
            footer_x = left_x
            draw.text((footer_x, footer_y), footer_text, font=label_font, fill=255)

        context.disp.display(context.image)
        return offset

    scroll_offset = render(scroll_offset)
    menus.wait_for_buttons_release(
        [gpio.PIN_A, gpio.PIN_B, gpio.PIN_L, gpio.PIN_R, gpio.PIN_U, gpio.PIN_D]
    )
    prev_states = {
        "A": gpio.read_button(gpio.PIN_A),
        "B": gpio.read_button(gpio.PIN_B),
        "L": gpio.read_button(gpio.PIN_L),
        "R": gpio.read_button(gpio.PIN_R),
        "U": gpio.read_button(gpio.PIN_U),
        "D": gpio.read_button(gpio.PIN_D),
    }
    while True:
        current_a = gpio.read_button(gpio.PIN_A)
        if prev_states["A"] and not current_a:
            return
        current_b = gpio.read_button(gpio.PIN_B)
        if prev_states["B"] and not current_b:
            return
        current_l = gpio.read_button(gpio.PIN_L)
        if prev_states["L"] and not current_l:
            return
        current_r = gpio.read_button(gpio.PIN_R)
        current_u = gpio.read_button(gpio.PIN_U)
        if prev_states["U"] and not current_u:
            scroll_offset = max(0, scroll_offset - 1)
            scroll_offset = render(scroll_offset)
        current_d = gpio.read_button(gpio.PIN_D)
        if prev_states["D"] and not current_d:
            scroll_offset = min(max_offset, scroll_offset + 1)
            scroll_offset = render(scroll_offset)
        prev_states["A"] = current_a
        prev_states["B"] = current_b
        prev_states["L"] = current_l
        prev_states["R"] = current_r
        prev_states["U"] = current_u
        prev_states["D"] = current_d
        time.sleep(0.05)


def show_lucide_demo(title: str = "LUCIDE") -> None:
    """Display all Lucide icons in a scrollable grid."""
    # All Lucide icon codes extracted from CSS
    all_icon_codes = [
        0xE038,
        0xE039,
        0xE03A,
        0xE03B,
        0xE03C,
        0xE03D,
        0xE03E,
        0xE03F,
        0xE040,
        0xE041,
        0xE042,
        0xE043,
        0xE044,
        0xE045,
        0xE046,
        0xE047,
        0xE048,
        0xE049,
        0xE04A,
        0xE04B,
        0xE04C,
        0xE04D,
        0xE04E,
        0xE04F,
        0xE050,
        0xE051,
        0xE052,
        0xE053,
        0xE054,
        0xE055,
        0xE056,
        0xE057,
        0xE058,
        0xE059,
        0xE05A,
        0xE05B,
        0xE05C,
        0xE05D,
        0xE05E,
        0xE05F,
        0xE060,
        0xE061,
        0xE062,
        0xE063,
        0xE064,
        0xE065,
        0xE066,
        0xE068,
        0xE069,
        0xE06A,
        0xE06B,
        0xE06C,
        0xE06D,
        0xE06E,
        0xE06F,
        0xE070,
        0xE071,
        0xE072,
        0xE073,
        0xE074,
        0xE075,
        0xE076,
        0xE077,
        0xE078,
        0xE079,
        0xE07A,
        0xE07B,
        0xE07C,
        0xE07D,
        0xE07E,
        0xE07F,
        0xE080,
        0xE081,
        0xE082,
        0xE083,
        0xE084,
        0xE085,
        0xE086,
        0xE087,
        0xE088,
        0xE089,
        0xE08A,
        0xE08B,
        0xE08C,
        0xE08D,
        0xE08E,
        0xE08F,
        0xE090,
        0xE091,
        0xE092,
        0xE093,
        0xE094,
        0xE095,
        0xE096,
        0xE097,
        0xE098,
        0xE099,
        0xE09A,
        0xE09B,
        0xE09C,
        0xE09D,
        0xE09E,
        0xE09F,
        0xE0A0,
        0xE0A1,
        0xE0A2,
        0xE0A3,
        0xE0A4,
        0xE0A5,
        0xE0A6,
        0xE0A7,
        0xE0A8,
        0xE0A9,
        0xE0AA,
        0xE0AB,
        0xE0AC,
        0xE0AD,
        0xE0AE,
        0xE0AF,
        0xE0B0,
        0xE0B1,
        0xE0B2,
        0xE0B3,
        0xE0B4,
        0xE0B5,
        0xE0B6,
        0xE0B7,
        0xE0B8,
        0xE0B9,
        0xE0BA,
        0xE0BB,
        0xE0BC,
        0xE0BD,
        0xE0BE,
        0xE0BF,
        0xE0C0,
        0xE0C1,
        0xE0C2,
        0xE0C3,
        0xE0C4,
        0xE0C5,
        0xE0C6,
        0xE0C7,
        0xE0C8,
        0xE0C9,
        0xE0CA,
        0xE0CB,
        0xE0CC,
        0xE0CD,
        0xE0CE,
        0xE0CF,
        0xE0D0,
        0xE0D1,
        0xE0D2,
        0xE0D3,
        0xE0D4,
        0xE0D5,
        0xE0D6,
        0xE0D7,
        0xE0D8,
        0xE0D9,
        0xE0DA,
        0xE0DB,
        0xE0DC,
        0xE0DD,
        0xE0DE,
        0xE0DF,
        0xE0E0,
        0xE0E1,
        0xE0E2,
        0xE0E3,
        0xE0E4,
        0xE0E5,
        0xE0E6,
        0xE0E7,
        0xE0E8,
        0xE0E9,
        0xE0EA,
        0xE0EB,
        0xE0EC,
        0xE0ED,
        0xE0EE,
        0xE0EF,
        0xE0F0,
        0xE0F1,
        0xE0F2,
        0xE0F3,
        0xE0F4,
        0xE0F5,
        0xE0F6,
        0xE0F7,
        0xE0F8,
        0xE0F9,
        0xE0FA,
        0xE0FB,
        0xE0FC,
        0xE0FD,
        0xE0FE,
        0xE0FF,
        0xE100,
        0xE101,
        0xE102,
        0xE103,
        0xE104,
        0xE105,
        0xE106,
        0xE107,
        0xE108,
        0xE109,
        0xE10A,
        0xE10B,
        0xE10C,
        0xE10D,
        0xE10E,
        0xE10F,
        0xE110,
        0xE111,
        0xE112,
        0xE113,
        0xE114,
        0xE115,
        0xE116,
        0xE117,
        0xE118,
        0xE119,
        0xE11A,
        0xE11B,
        0xE11C,
        0xE11D,
        0xE11E,
        0xE11F,
        0xE120,
        0xE121,
        0xE122,
        0xE123,
        0xE124,
        0xE125,
        0xE126,
        0xE127,
        0xE128,
        0xE129,
        0xE12A,
        0xE12B,
        0xE12C,
        0xE12D,
        0xE12E,
        0xE12F,
        0xE130,
        0xE131,
        0xE132,
        0xE133,
        0xE134,
        0xE135,
        0xE136,
        0xE137,
        0xE138,
        0xE139,
        0xE13A,
        0xE13B,
        0xE13C,
        0xE13D,
        0xE13E,
        0xE13F,
        0xE140,
        0xE141,
        0xE142,
        0xE143,
        0xE144,
        0xE145,
        0xE146,
        0xE147,
        0xE148,
        0xE149,
        0xE14A,
        0xE14B,
        0xE14C,
        0xE14D,
        0xE14E,
        0xE14F,
        0xE150,
        0xE151,
        0xE152,
        0xE153,
        0xE154,
        0xE155,
        0xE156,
        0xE157,
        0xE158,
        0xE159,
        0xE15A,
        0xE15B,
        0xE15C,
        0xE15D,
        0xE15E,
        0xE15F,
        0xE160,
        0xE161,
        0xE162,
        0xE163,
        0xE164,
        0xE165,
        0xE166,
        0xE167,
        0xE168,
        0xE169,
        0xE16A,
        0xE16B,
        0xE16C,
        0xE16D,
        0xE16E,
        0xE16F,
        0xE170,
        0xE171,
        0xE172,
        0xE173,
        0xE174,
        0xE175,
        0xE176,
        0xE177,
        0xE178,
        0xE179,
        0xE17A,
        0xE17B,
        0xE17C,
        0xE17D,
        0xE17E,
        0xE17F,
        0xE180,
        0xE181,
        0xE182,
        0xE183,
        0xE184,
        0xE185,
        0xE186,
        0xE187,
        0xE188,
        0xE189,
        0xE18A,
        0xE18B,
        0xE18C,
        0xE18D,
        0xE18E,
        0xE18F,
        0xE190,
        0xE191,
        0xE192,
        0xE193,
        0xE194,
        0xE195,
        0xE196,
        0xE197,
        0xE198,
        0xE199,
        0xE19A,
        0xE19B,
        0xE19C,
        0xE19D,
        0xE19E,
        0xE19F,
        0xE1A0,
        0xE1A1,
        0xE1A2,
        0xE1A3,
        0xE1A4,
        0xE1A5,
        0xE1A6,
        0xE1A7,
        0xE1A8,
        0xE1A9,
        0xE1AA,
        0xE1AB,
        0xE1AC,
        0xE1AD,
        0xE1AE,
        0xE1AF,
        0xE1B0,
        0xE1B1,
        0xE1B2,
        0xE1B3,
        0xE1B4,
        0xE1B5,
        0xE1B6,
        0xE1B7,
        0xE1B8,
        0xE1B9,
        0xE1BA,
        0xE1BB,
        0xE1BC,
        0xE1BD,
        0xE1BE,
        0xE1BF,
        0xE1C0,
        0xE1C1,
        0xE1C2,
        0xE1C3,
        0xE1C4,
        0xE1C5,
        0xE1C6,
        0xE1C7,
        0xE1C8,
        0xE1C9,
        0xE1CA,
        0xE1CB,
        0xE1CC,
        0xE1CD,
        0xE1CE,
        0xE1CF,
        0xE1D0,
        0xE1D1,
        0xE1D2,
        0xE1D3,
        0xE1D4,
        0xE1D5,
        0xE1D6,
        0xE1D7,
        0xE1D8,
        0xE1D9,
        0xE1DA,
        0xE1DB,
        0xE1DC,
        0xE1DD,
        0xE1DE,
        0xE1DF,
        0xE1E0,
        0xE1E1,
        0xE1E2,
        0xE1E3,
        0xE1E4,
        0xE1E5,
        0xE1E6,
        0xE1E7,
        0xE1E8,
        0xE1E9,
        0xE1EA,
        0xE1EB,
        0xE1EC,
        0xE1ED,
        0xE1EE,
        0xE1EF,
        0xE1F0,
        0xE1F1,
        0xE1F2,
        0xE1F3,
        0xE1F4,
        0xE1F5,
        0xE1F6,
        0xE1F7,
        0xE1F8,
        0xE1F9,
        0xE1FA,
        0xE1FB,
        0xE1FC,
        0xE1FD,
        0xE1FE,
        0xE1FF,
        0xE200,
        0xE201,
        0xE202,
        0xE203,
        0xE204,
        0xE205,
        0xE206,
        0xE207,
        0xE208,
        0xE209,
        0xE20A,
        0xE20B,
        0xE20C,
        0xE20D,
        0xE20E,
        0xE20F,
        0xE210,
        0xE211,
        0xE212,
        0xE213,
        0xE214,
        0xE215,
        0xE216,
        0xE217,
        0xE218,
        0xE219,
        0xE21A,
        0xE21B,
        0xE21C,
        0xE21D,
        0xE21E,
        0xE21F,
        0xE220,
        0xE221,
        0xE222,
        0xE223,
        0xE224,
        0xE225,
        0xE226,
        0xE227,
        0xE228,
        0xE229,
        0xE22A,
        0xE22B,
        0xE22C,
        0xE22D,
        0xE22E,
        0xE22F,
        0xE230,
        0xE231,
        0xE232,
        0xE233,
        0xE234,
        0xE235,
        0xE236,
        0xE237,
        0xE238,
        0xE239,
        0xE23A,
        0xE23B,
        0xE23C,
        0xE23D,
        0xE23E,
        0xE23F,
        0xE240,
        0xE241,
        0xE242,
        0xE243,
        0xE244,
        0xE245,
        0xE246,
        0xE247,
        0xE248,
        0xE249,
        0xE24A,
        0xE24B,
        0xE24C,
        0xE24D,
        0xE24E,
        0xE24F,
        0xE250,
        0xE251,
        0xE252,
        0xE253,
        0xE254,
        0xE255,
        0xE256,
        0xE257,
        0xE258,
        0xE259,
        0xE25A,
        0xE25B,
        0xE25C,
        0xE25D,
        0xE25E,
        0xE25F,
        0xE260,
        0xE261,
        0xE262,
        0xE263,
        0xE264,
        0xE265,
        0xE266,
        0xE267,
        0xE268,
        0xE269,
        0xE26A,
        0xE26B,
        0xE26C,
        0xE26D,
        0xE26E,
        0xE26F,
        0xE270,
        0xE271,
        0xE272,
        0xE273,
        0xE274,
        0xE275,
        0xE276,
        0xE277,
        0xE278,
        0xE279,
        0xE27A,
        0xE27B,
        0xE27C,
        0xE27D,
        0xE27E,
        0xE27F,
        0xE280,
        0xE281,
        0xE282,
        0xE283,
        0xE284,
        0xE285,
        0xE286,
        0xE287,
        0xE288,
        0xE289,
        0xE28A,
        0xE28B,
        0xE28C,
        0xE28D,
        0xE28E,
        0xE28F,
        0xE290,
        0xE291,
        0xE292,
        0xE293,
        0xE294,
        0xE295,
        0xE296,
        0xE297,
        0xE298,
        0xE299,
        0xE29A,
        0xE29B,
        0xE29C,
        0xE29D,
        0xE29E,
        0xE29F,
        0xE2A0,
        0xE2A1,
        0xE2A2,
        0xE2A3,
        0xE2A4,
        0xE2A5,
        0xE2A6,
        0xE2A7,
        0xE2A8,
        0xE2A9,
        0xE2AA,
        0xE2AB,
        0xE2AC,
        0xE2AD,
        0xE2AE,
        0xE2AF,
        0xE2B0,
        0xE2B1,
        0xE2B2,
        0xE2B3,
        0xE2B4,
        0xE2B5,
        0xE2B6,
        0xE2B7,
        0xE2B8,
        0xE2B9,
        0xE2BA,
        0xE2BB,
        0xE2BC,
        0xE2BD,
        0xE2BE,
        0xE2BF,
        0xE2C0,
        0xE2C1,
        0xE2C2,
        0xE2C3,
        0xE2C4,
        0xE2C5,
        0xE2C6,
        0xE2C7,
        0xE2C8,
        0xE2C9,
        0xE2CA,
        0xE2CB,
        0xE2CC,
        0xE2CD,
        0xE2CE,
        0xE2CF,
        0xE2D0,
        0xE2D1,
        0xE2D2,
        0xE2D3,
        0xE2D4,
        0xE2D5,
        0xE2D6,
        0xE2D7,
        0xE2D8,
        0xE2D9,
        0xE2DA,
        0xE2DB,
        0xE2DC,
        0xE2DD,
        0xE2DE,
        0xE2DF,
        0xE2E0,
        0xE2E1,
        0xE2E2,
        0xE2E3,
        0xE2E4,
        0xE2E5,
        0xE2E6,
        0xE2E7,
        0xE2E8,
        0xE2E9,
        0xE2EA,
        0xE2EB,
        0xE2EC,
        0xE2ED,
        0xE2EE,
        0xE2EF,
        0xE2F0,
        0xE2F1,
        0xE2F2,
        0xE2F3,
        0xE2F4,
        0xE2F5,
        0xE2F6,
        0xE2F7,
        0xE2F8,
        0xE2F9,
        0xE2FA,
        0xE2FB,
        0xE2FC,
        0xE2FD,
        0xE2FE,
        0xE2FF,
        0xE300,
        0xE301,
        0xE302,
        0xE303,
        0xE304,
        0xE305,
        0xE306,
        0xE307,
        0xE308,
        0xE309,
        0xE30A,
        0xE30B,
        0xE30C,
        0xE30D,
        0xE30E,
        0xE30F,
        0xE310,
        0xE311,
        0xE312,
        0xE313,
        0xE314,
        0xE315,
        0xE316,
        0xE317,
        0xE318,
        0xE319,
        0xE31A,
        0xE31B,
        0xE31C,
        0xE31D,
        0xE31E,
        0xE31F,
        0xE320,
        0xE321,
        0xE322,
        0xE323,
        0xE324,
        0xE325,
        0xE326,
        0xE327,
        0xE328,
        0xE329,
        0xE32A,
        0xE32B,
        0xE32C,
        0xE32D,
        0xE32E,
        0xE32F,
        0xE330,
        0xE331,
        0xE332,
        0xE333,
        0xE334,
        0xE335,
        0xE336,
        0xE337,
        0xE338,
        0xE339,
        0xE33A,
        0xE33B,
        0xE33C,
        0xE33D,
        0xE33E,
        0xE33F,
        0xE340,
        0xE341,
        0xE342,
        0xE343,
        0xE344,
        0xE345,
        0xE346,
        0xE347,
        0xE348,
        0xE349,
        0xE34A,
        0xE34B,
        0xE34C,
        0xE34D,
        0xE34E,
        0xE34F,
        0xE350,
        0xE351,
        0xE352,
        0xE353,
        0xE354,
        0xE355,
        0xE356,
        0xE357,
        0xE358,
        0xE359,
        0xE35A,
        0xE35B,
        0xE35C,
        0xE35D,
        0xE35E,
        0xE35F,
        0xE360,
        0xE361,
        0xE362,
        0xE363,
        0xE364,
        0xE365,
        0xE366,
        0xE367,
        0xE368,
        0xE369,
        0xE36A,
        0xE36B,
        0xE36C,
        0xE36D,
        0xE36E,
        0xE36F,
        0xE370,
        0xE371,
        0xE372,
        0xE373,
        0xE374,
        0xE375,
        0xE376,
        0xE377,
        0xE378,
        0xE379,
        0xE37A,
        0xE37B,
        0xE37C,
        0xE37D,
        0xE37E,
        0xE37F,
        0xE380,
        0xE381,
        0xE382,
        0xE383,
        0xE384,
        0xE385,
        0xE386,
        0xE387,
        0xE388,
        0xE389,
        0xE38A,
        0xE38B,
        0xE38C,
        0xE38D,
        0xE38E,
        0xE38F,
        0xE390,
        0xE391,
        0xE392,
        0xE393,
        0xE394,
        0xE395,
        0xE396,
        0xE397,
        0xE398,
        0xE399,
        0xE39A,
        0xE39B,
        0xE39C,
        0xE39D,
        0xE39E,
        0xE39F,
        0xE3A0,
        0xE3A1,
        0xE3A2,
        0xE3A3,
        0xE3A4,
        0xE3A5,
        0xE3A6,
        0xE3A7,
        0xE3A8,
        0xE3A9,
        0xE3AA,
        0xE3AB,
        0xE3AC,
        0xE3AD,
        0xE3AE,
        0xE3AF,
        0xE3B0,
        0xE3B1,
        0xE3B2,
        0xE3B3,
        0xE3B4,
        0xE3B5,
        0xE3B6,
        0xE3B7,
        0xE3B8,
        0xE3B9,
        0xE3BA,
        0xE3BB,
        0xE3BC,
        0xE3BD,
        0xE3BE,
        0xE3BF,
        0xE3C0,
        0xE3C1,
        0xE3C2,
        0xE3C3,
        0xE3C4,
        0xE3C5,
        0xE3C6,
        0xE3C7,
        0xE3C8,
        0xE3C9,
        0xE3CA,
        0xE3CB,
        0xE3CC,
        0xE3CD,
        0xE3CE,
        0xE3CF,
        0xE3D0,
        0xE3D1,
        0xE3D2,
        0xE3D3,
        0xE3D4,
        0xE3D5,
        0xE3D6,
        0xE3D7,
        0xE3D8,
        0xE3D9,
        0xE3DA,
        0xE3DB,
        0xE3DC,
        0xE3DD,
        0xE3DE,
        0xE3DF,
        0xE3E0,
        0xE3E1,
        0xE3E2,
        0xE3E3,
        0xE3E4,
        0xE3E5,
        0xE3E6,
        0xE3E7,
        0xE3E8,
        0xE3E9,
        0xE3EA,
        0xE3EB,
        0xE3EC,
        0xE3ED,
        0xE3EE,
        0xE3EF,
        0xE3F0,
        0xE3F1,
        0xE3F2,
        0xE3F3,
        0xE3F4,
        0xE3F5,
        0xE3F6,
        0xE3F7,
        0xE3F8,
        0xE3F9,
        0xE3FA,
        0xE3FB,
        0xE3FC,
        0xE3FD,
        0xE3FE,
        0xE3FF,
        0xE400,
        0xE401,
        0xE402,
        0xE403,
        0xE404,
        0xE405,
        0xE406,
        0xE407,
        0xE408,
        0xE409,
        0xE40A,
        0xE40B,
        0xE40C,
        0xE40D,
        0xE40E,
        0xE40F,
        0xE410,
        0xE411,
        0xE412,
        0xE413,
        0xE414,
        0xE415,
        0xE416,
        0xE417,
        0xE418,
        0xE419,
        0xE41A,
        0xE41B,
        0xE41C,
        0xE41D,
        0xE41E,
        0xE41F,
        0xE420,
        0xE421,
        0xE422,
        0xE423,
        0xE424,
        0xE425,
        0xE426,
        0xE427,
        0xE428,
        0xE429,
        0xE42A,
        0xE42B,
        0xE42C,
        0xE42D,
        0xE42E,
        0xE42F,
        0xE430,
        0xE431,
        0xE432,
        0xE433,
        0xE434,
        0xE435,
        0xE436,
        0xE437,
        0xE438,
        0xE439,
        0xE43A,
        0xE43B,
        0xE43C,
        0xE43D,
        0xE43E,
        0xE43F,
        0xE440,
        0xE441,
        0xE442,
        0xE443,
        0xE444,
        0xE445,
        0xE446,
        0xE447,
        0xE448,
        0xE449,
        0xE44A,
        0xE44B,
        0xE44C,
        0xE44D,
        0xE44E,
        0xE44F,
        0xE450,
        0xE451,
        0xE452,
        0xE453,
        0xE454,
        0xE455,
        0xE456,
        0xE457,
        0xE458,
        0xE459,
        0xE45A,
        0xE45B,
        0xE45C,
        0xE45D,
        0xE45E,
        0xE45F,
        0xE460,
        0xE461,
        0xE462,
        0xE463,
        0xE464,
        0xE465,
        0xE466,
        0xE467,
        0xE468,
        0xE469,
        0xE46A,
        0xE46B,
        0xE46C,
        0xE46D,
        0xE46E,
        0xE46F,
        0xE470,
        0xE471,
        0xE472,
        0xE473,
        0xE474,
        0xE475,
        0xE476,
        0xE477,
        0xE478,
        0xE479,
        0xE47A,
        0xE47B,
        0xE47C,
        0xE47D,
        0xE47E,
        0xE47F,
        0xE480,
        0xE481,
        0xE482,
        0xE483,
        0xE484,
        0xE485,
        0xE486,
        0xE487,
        0xE488,
        0xE489,
        0xE48A,
        0xE48B,
        0xE48C,
        0xE48D,
        0xE48E,
        0xE48F,
        0xE490,
        0xE491,
        0xE492,
        0xE493,
        0xE494,
        0xE495,
        0xE496,
        0xE497,
        0xE498,
        0xE499,
        0xE49A,
        0xE49B,
        0xE49C,
        0xE49D,
        0xE49E,
        0xE49F,
        0xE4A0,
        0xE4A1,
        0xE4A2,
        0xE4A3,
        0xE4A4,
        0xE4A5,
        0xE4A6,
        0xE4A7,
        0xE4A8,
        0xE4A9,
        0xE4AA,
        0xE4AB,
        0xE4AC,
        0xE4AD,
        0xE4AE,
        0xE4AF,
        0xE4B0,
        0xE4B1,
        0xE4B2,
        0xE4B3,
        0xE4B4,
        0xE4B5,
        0xE4B6,
        0xE4B7,
        0xE4B8,
        0xE4B9,
        0xE4BA,
        0xE4BB,
        0xE4BC,
        0xE4BD,
        0xE4BE,
        0xE4BF,
        0xE4C0,
        0xE4C1,
        0xE4C2,
        0xE4C3,
        0xE4C4,
        0xE4C5,
        0xE4C6,
        0xE4C7,
        0xE4C8,
        0xE4C9,
        0xE4CA,
        0xE4CB,
        0xE4CC,
        0xE4CD,
        0xE4CE,
        0xE4CF,
        0xE4D0,
        0xE4D1,
        0xE4D2,
        0xE4D3,
        0xE4D4,
        0xE4D5,
        0xE4D6,
        0xE4D7,
        0xE4D8,
        0xE4D9,
        0xE4DA,
        0xE4DB,
        0xE4DC,
        0xE4DD,
        0xE4DE,
        0xE4DF,
        0xE4E0,
        0xE4E1,
        0xE4E2,
        0xE4E3,
        0xE4E4,
        0xE4E5,
        0xE4E6,
        0xE4E7,
        0xE4E8,
        0xE4E9,
        0xE4EA,
        0xE4EB,
        0xE4EC,
        0xE4ED,
        0xE4EE,
        0xE4EF,
        0xE4F0,
        0xE4F1,
        0xE4F2,
        0xE4F3,
        0xE4F4,
        0xE4F5,
        0xE4F6,
        0xE4F7,
        0xE4F8,
        0xE4F9,
        0xE4FA,
        0xE4FB,
        0xE4FC,
        0xE4FD,
        0xE4FE,
        0xE4FF,
        0xE500,
        0xE501,
        0xE502,
        0xE503,
        0xE504,
        0xE505,
        0xE506,
        0xE507,
        0xE508,
        0xE509,
        0xE50A,
        0xE50B,
        0xE50C,
        0xE50D,
        0xE50E,
        0xE50F,
        0xE510,
        0xE511,
        0xE512,
        0xE513,
        0xE514,
        0xE515,
        0xE516,
        0xE517,
        0xE518,
        0xE519,
        0xE51A,
        0xE51B,
        0xE51C,
        0xE51D,
        0xE51E,
        0xE51F,
        0xE520,
        0xE521,
        0xE522,
        0xE523,
        0xE524,
        0xE525,
        0xE526,
        0xE527,
        0xE528,
        0xE529,
        0xE52A,
        0xE52B,
        0xE52C,
        0xE52D,
        0xE52E,
        0xE52F,
        0xE530,
        0xE531,
        0xE532,
        0xE533,
        0xE534,
        0xE535,
        0xE536,
        0xE537,
        0xE538,
        0xE539,
        0xE53A,
        0xE53B,
        0xE53C,
        0xE53D,
        0xE53E,
        0xE53F,
        0xE540,
        0xE541,
        0xE542,
        0xE543,
        0xE544,
        0xE545,
        0xE546,
        0xE547,
        0xE548,
        0xE549,
        0xE54A,
        0xE54B,
        0xE54C,
        0xE54D,
        0xE54E,
        0xE54F,
        0xE550,
        0xE551,
        0xE552,
        0xE553,
        0xE554,
        0xE555,
        0xE556,
        0xE557,
        0xE558,
        0xE559,
        0xE55A,
        0xE55B,
        0xE55C,
        0xE55D,
        0xE55E,
        0xE55F,
        0xE560,
        0xE561,
        0xE562,
        0xE563,
        0xE564,
        0xE565,
        0xE566,
        0xE567,
        0xE568,
        0xE569,
        0xE56A,
        0xE56B,
        0xE56C,
        0xE56D,
        0xE56E,
        0xE56F,
        0xE570,
        0xE571,
        0xE572,
        0xE573,
        0xE574,
        0xE575,
        0xE576,
        0xE577,
        0xE578,
        0xE579,
        0xE57A,
        0xE57B,
        0xE57C,
        0xE57D,
        0xE57E,
        0xE57F,
        0xE580,
        0xE581,
        0xE582,
        0xE583,
        0xE584,
        0xE585,
        0xE586,
        0xE587,
        0xE588,
        0xE589,
        0xE58A,
        0xE58B,
        0xE58C,
        0xE58D,
        0xE58E,
        0xE58F,
        0xE590,
        0xE591,
        0xE592,
        0xE593,
        0xE594,
        0xE595,
        0xE596,
        0xE597,
        0xE598,
        0xE599,
        0xE59A,
        0xE59B,
        0xE59C,
        0xE59D,
        0xE59E,
        0xE59F,
        0xE5A0,
        0xE5A1,
        0xE5A2,
        0xE5A3,
        0xE5A4,
        0xE5A5,
        0xE5A6,
        0xE5A7,
        0xE5A8,
        0xE5A9,
        0xE5AA,
        0xE5AB,
        0xE5AC,
        0xE5AD,
        0xE5AE,
        0xE5AF,
        0xE5B0,
        0xE5B1,
        0xE5B2,
        0xE5B3,
        0xE5B4,
        0xE5B5,
        0xE5B6,
        0xE5B7,
        0xE5B8,
        0xE5B9,
        0xE5BA,
        0xE5BB,
        0xE5BC,
        0xE5BD,
        0xE5BE,
        0xE5BF,
        0xE5C0,
        0xE5C1,
        0xE5C2,
        0xE5C3,
        0xE5C4,
        0xE5C5,
        0xE5C6,
        0xE5C7,
        0xE5C8,
        0xE5C9,
        0xE5CA,
        0xE5CB,
        0xE5CC,
        0xE5CD,
        0xE5CE,
        0xE5CF,
        0xE5D0,
        0xE5D1,
        0xE5D2,
        0xE5D3,
        0xE5D4,
        0xE5D5,
        0xE5D6,
        0xE5D7,
        0xE5D8,
        0xE5D9,
        0xE5DA,
        0xE5DB,
        0xE5DC,
        0xE5DD,
        0xE5DE,
        0xE5DF,
        0xE5E0,
        0xE5E1,
        0xE5E2,
        0xE5E3,
        0xE5E4,
        0xE5E5,
        0xE5E6,
        0xE5E7,
        0xE5E8,
        0xE5E9,
        0xE5EA,
        0xE5EB,
        0xE5EC,
        0xE5ED,
        0xE5EE,
        0xE5EF,
        0xE5F0,
        0xE5F1,
        0xE5F2,
        0xE5F3,
        0xE5F4,
        0xE5F5,
        0xE5F6,
        0xE5F7,
        0xE5F8,
        0xE5F9,
        0xE5FA,
        0xE5FB,
        0xE5FC,
        0xE5FD,
        0xE5FE,
        0xE5FF,
        0xE600,
        0xE601,
        0xE602,
        0xE603,
        0xE604,
        0xE605,
        0xE606,
        0xE607,
        0xE608,
        0xE609,
        0xE60A,
        0xE60B,
        0xE60C,
        0xE60D,
        0xE60E,
        0xE60F,
        0xE610,
        0xE611,
        0xE612,
        0xE613,
        0xE614,
        0xE615,
        0xE616,
        0xE617,
        0xE618,
        0xE619,
        0xE61A,
        0xE61B,
        0xE61C,
        0xE61D,
        0xE61E,
        0xE61F,
        0xE620,
        0xE621,
        0xE622,
        0xE623,
        0xE624,
        0xE625,
        0xE626,
        0xE627,
        0xE628,
        0xE629,
        0xE62A,
        0xE62B,
        0xE62C,
        0xE62D,
        0xE62E,
        0xE62F,
        0xE630,
        0xE631,
        0xE632,
        0xE633,
        0xE634,
        0xE635,
        0xE636,
        0xE637,
        0xE638,
        0xE639,
        0xE63A,
        0xE63B,
        0xE63C,
        0xE63D,
        0xE63E,
        0xE63F,
        0xE640,
        0xE641,
        0xE642,
        0xE643,
        0xE644,
        0xE645,
        0xE646,
        0xE647,
        0xE648,
        0xE649,
        0xE64A,
        0xE64B,
        0xE64C,
        0xE64D,
        0xE64E,
        0xE64F,
        0xE650,
        0xE651,
        0xE652,
        0xE653,
        0xE654,
        0xE655,
        0xE656,
        0xE657,
        0xE658,
        0xE659,
        0xE65A,
        0xE65B,
        0xE65C,
        0xE65D,
        0xE65E,
        0xE65F,
        0xE660,
        0xE661,
        0xE662,
        0xE663,
        0xE664,
        0xE665,
        0xE666,
        0xE667,
        0xE668,
        0xE669,
        0xE66A,
        0xE66B,
        0xE66C,
        0xE66D,
        0xE66E,
        0xE66F,
        0xE670,
        0xE671,
        0xE672,
        0xE673,
        0xE674,
        0xE675,
        0xE676,
        0xE677,
        0xE678,
        0xE679,
        0xE67A,
        0xE67B,
        0xE67C,
        0xE67D,
        0xE67E,
        0xE67F,
        0xE680,
        0xE681,
        0xE682,
        0xE683,
        0xE684,
        0xE685,
        0xE686,
        0xE687,
        0xE688,
        0xE689,
        0xE68A,
        0xE68B,
        0xE68C,
        0xE68D,
        0xE68E,
        0xE68F,
        0xE690,
        0xE691,
        0xE692,
        0xE693,
        0xE694,
        0xE695,
        0xE696,
        0xE697,
        0xE698,
        0xE699,
        0xE69A,
        0xE69B,
        0xE69C,
        0xE69D,
        0xE69E,
        0xE69F,
        0xE6A0,
        0xE6A1,
        0xE6A2,
        0xE6A3,
        0xE6A4,
        0xE6A5,
        0xE6A6,
        0xE6A7,
        0xE6A8,
        0xE6A9,
        0xE6AA,
        0xE6AB,
        0xE6AC,
        0xE6AD,
        0xE6AE,
        0xE6AF,
        0xE6B0,
        0xE6B1,
        0xE6B2,
        0xE6B3,
        0xE6B4,
        0xE6B5,
        0xE6B6,
        0xE6B7,
        0xE6B8,
        0xE6B9,
    ]

    context = display.get_display_context()
    title_font = context.fonts.get("title", context.fontdisks)
    content_top = menus.get_standard_content_top(title, title_font=title_font)

    font_path = display.ASSETS_DIR / "fonts" / "lucide.ttf"
    icon_size = 16
    icon_font = ImageFont.truetype(str(font_path), icon_size)

    # Grid settings
    icon_spacing = 4
    icons_per_row = 6
    row_height = icon_size + icon_spacing

    # Calculate total rows and scrolling
    total_icons = len(all_icon_codes)
    total_rows = (total_icons + icons_per_row - 1) // icons_per_row
    rows_per_page = max(1, (context.height - content_top - 12) // row_height)
    max_offset = max(0, total_rows - rows_per_page)
    scroll_offset = 0

    def render(offset: int) -> int:
        offset = max(0, min(offset, max_offset))

        draw = context.draw
        draw.rectangle((0, 0, context.width, context.height), outline=0, fill=0)

        # Draw title with icon using proper function
        layout = display.draw_title_with_icon(
            title,
            title_font=title_font,
            icon=chr(0xE24B),  # Sparkles icon
            extra_gap=1,
            left_margin=context.x - 11,
            draw=draw,
        )

        # Draw grid of icons
        start_row = offset
        end_row = min(total_rows, offset + rows_per_page)

        current_y = layout.content_top
        for row in range(start_row, end_row):
            start_idx = row * icons_per_row
            end_idx = min(total_icons, start_idx + icons_per_row)

            # Center the row horizontally
            icons_in_row = end_idx - start_idx
            row_width = icons_in_row * (icon_size + icon_spacing) - icon_spacing
            start_x = (context.width - row_width) // 2

            current_x = start_x
            for idx in range(start_idx, end_idx):
                icon_code = all_icon_codes[idx]
                glyph = chr(icon_code)
                draw.text((current_x, current_y), glyph, font=icon_font, fill=255)
                current_x += icon_size + icon_spacing

            current_y += row_height

        # Show scroll indicator and count
        if total_rows > rows_per_page:
            footer_text = f"▲▼ scroll • {total_icons} icons"
            footer_font = context.fontdisks
            footer_height = display._get_line_height(footer_font)
            footer_y = context.height - footer_height - 1
            footer_x = context.x - 11
            draw.text((footer_x, footer_y), footer_text, font=footer_font, fill=255)
        else:
            # Just show count
            footer_text = f"{total_icons} icons"
            footer_font = context.fontdisks
            footer_height = display._get_line_height(footer_font)
            footer_y = context.height - footer_height - 1
            footer_x = context.x - 11
            draw.text((footer_x, footer_y), footer_text, font=footer_font, fill=255)

        context.disp.display(context.image)
        return offset

    scroll_offset = render(scroll_offset)
    menus.wait_for_buttons_release(
        [gpio.PIN_A, gpio.PIN_B, gpio.PIN_L, gpio.PIN_R, gpio.PIN_U, gpio.PIN_D]
    )
    prev_states = {
        "A": gpio.read_button(gpio.PIN_A),
        "B": gpio.read_button(gpio.PIN_B),
        "L": gpio.read_button(gpio.PIN_L),
        "R": gpio.read_button(gpio.PIN_R),
        "U": gpio.read_button(gpio.PIN_U),
        "D": gpio.read_button(gpio.PIN_D),
    }
    while True:
        current_a = gpio.read_button(gpio.PIN_A)
        if prev_states["A"] and not current_a:
            return
        current_b = gpio.read_button(gpio.PIN_B)
        if prev_states["B"] and not current_b:
            return
        current_l = gpio.read_button(gpio.PIN_L)
        if prev_states["L"] and not current_l:
            return
        current_r = gpio.read_button(gpio.PIN_R)
        current_u = gpio.read_button(gpio.PIN_U)
        if prev_states["U"] and not current_u:
            scroll_offset = max(0, scroll_offset - 1)
            scroll_offset = render(scroll_offset)
        current_d = gpio.read_button(gpio.PIN_D)
        if prev_states["D"] and not current_d:
            scroll_offset = min(max_offset, scroll_offset + 1)
            scroll_offset = render(scroll_offset)
        prev_states["A"] = current_a
        prev_states["B"] = current_b
        prev_states["L"] = current_l
        prev_states["R"] = current_r
        prev_states["U"] = current_u
        prev_states["D"] = current_d
        time.sleep(0.05)


def show_heroicons_demo(title: str = "HEROICONS") -> None:
    """Display all Heroicons in a scrollable grid."""
    # All Heroicons icon codes
    all_icon_codes = [
        0xE900,
        0xE901,
        0xE902,
        0xE903,
        0xE904,
        0xE905,
        0xE906,
        0xE907,
        0xE908,
        0xE909,
        0xE90A,
        0xE90B,
        0xE90C,
        0xE90D,
        0xE90E,
        0xE90F,
        0xE910,
        0xE911,
        0xE912,
        0xE913,
        0xE914,
        0xE915,
        0xE916,
        0xE917,
        0xE918,
        0xE919,
        0xE91A,
        0xE91B,
        0xE91C,
        0xE91D,
        0xE91E,
        0xE91F,
        0xE920,
        0xE921,
        0xE922,
        0xE923,
        0xE924,
        0xE925,
        0xE926,
        0xE927,
        0xE928,
        0xE929,
        0xE92A,
        0xE92B,
        0xE92C,
        0xE92D,
        0xE92E,
        0xE92F,
        0xE930,
        0xE931,
        0xE932,
        0xE933,
        0xE934,
        0xE935,
        0xE936,
        0xE937,
        0xE938,
        0xE939,
        0xE93A,
        0xE93B,
        0xE93C,
        0xE93D,
        0xE93E,
        0xE93F,
        0xE940,
        0xE941,
        0xE942,
        0xE943,
        0xE944,
        0xE945,
        0xE946,
        0xE947,
        0xE948,
        0xE949,
        0xE94A,
        0xE94B,
        0xE94C,
        0xE94D,
        0xE94E,
        0xE94F,
        0xE950,
        0xE951,
        0xE952,
        0xE953,
        0xE954,
        0xE955,
        0xE956,
        0xE957,
        0xE958,
        0xE959,
        0xE95A,
        0xE95B,
        0xE95C,
        0xE95D,
        0xE95E,
        0xE95F,
        0xE960,
        0xE961,
        0xE962,
        0xE963,
        0xE964,
        0xE965,
        0xE966,
        0xE967,
        0xE968,
        0xE969,
        0xE96A,
        0xE96B,
        0xE96C,
        0xE96D,
        0xE96E,
        0xE96F,
        0xE970,
        0xE971,
        0xE972,
        0xE973,
        0xE974,
        0xE975,
        0xE976,
        0xE977,
        0xE978,
        0xE979,
        0xE97A,
        0xE97B,
        0xE97C,
        0xE97D,
        0xE97E,
        0xE97F,
        0xE980,
        0xE981,
        0xE982,
        0xE983,
        0xE984,
        0xE985,
        0xE986,
        0xE987,
        0xE988,
        0xE989,
        0xE98A,
        0xE98B,
        0xE98C,
        0xE98D,
        0xE98E,
        0xE98F,
        0xE990,
        0xE991,
        0xE992,
        0xE993,
        0xE994,
        0xE995,
        0xE996,
        0xE997,
        0xE998,
        0xE999,
        0xE99A,
        0xE99B,
        0xE99C,
        0xE99D,
        0xE99E,
        0xE99F,
        0xE9A0,
        0xE9A1,
        0xE9A2,
        0xE9A3,
        0xE9A4,
        0xE9A5,
        0xE9A6,
        0xE9A7,
        0xE9A8,
        0xE9A9,
        0xE9AA,
        0xE9AB,
        0xE9AC,
        0xE9AD,
        0xE9AE,
        0xE9AF,
        0xE9B0,
        0xE9B1,
        0xE9B2,
        0xE9B3,
        0xE9B4,
        0xE9B5,
        0xE9B6,
        0xE9B7,
        0xE9B8,
        0xE9B9,
        0xE9BA,
        0xE9BB,
        0xE9BC,
        0xE9BD,
        0xE9BE,
        0xE9BF,
        0xE9C0,
        0xE9C1,
        0xE9C2,
        0xE9C3,
        0xE9C4,
        0xE9C5,
        0xE9C6,
        0xE9C7,
        0xE9C8,
        0xE9C9,
        0xE9CA,
        0xE9CB,
        0xE9CC,
        0xE9CD,
        0xE9CE,
        0xE9CF,
        0xE9D0,
        0xE9D1,
        0xE9D2,
        0xE9D3,
        0xE9D4,
        0xE9D5,
        0xE9D6,
        0xE9D7,
        0xE9D8,
        0xE9D9,
        0xE9DA,
        0xE9DB,
        0xE9DC,
        0xE9DD,
        0xE9DE,
        0xE9DF,
        0xE9E0,
        0xE9E1,
        0xE9E2,
        0xE9E3,
        0xE9E4,
        0xE9E5,
        0xE9E6,
        0xE9E7,
        0xE9E8,
        0xE9E9,
        0xE9EA,
        0xE9EB,
        0xE9EC,
        0xE9ED,
        0xE9EE,
        0xE9EF,
        0xE9F0,
        0xE9F1,
        0xE9F2,
        0xE9F3,
        0xE9F4,
        0xE9F5,
        0xE9F6,
        0xE9F7,
        0xE9F8,
        0xE9F9,
        0xE9FA,
        0xE9FB,
        0xE9FC,
        0xE9FD,
        0xE9FE,
        0xE9FF,
        0xEA00,
        0xEA01,
        0xEA02,
        0xEA03,
        0xEA04,
        0xEA05,
        0xEA06,
        0xEA07,
        0xEA08,
        0xEA09,
        0xEA0A,
        0xEA0B,
        0xEA0C,
        0xEA0D,
        0xEA0E,
        0xEA0F,
        0xEA10,
        0xEA11,
        0xEA12,
        0xEA13,
        0xEA14,
        0xEA15,
        0xEA16,
        0xEA17,
        0xEA18,
        0xEA19,
        0xEA1A,
        0xEA1B,
        0xEA1C,
        0xEA1D,
        0xEA1E,
        0xEA1F,
        0xEA20,
        0xEA21,
        0xEA22,
        0xEA23,
        0xEA24,
        0xEA25,
        0xEA26,
        0xEA27,
    ]

    context = display.get_display_context()
    title_font = context.fonts.get("title", context.fontdisks)
    content_top = menus.get_standard_content_top(title, title_font=title_font)

    font_path = display.ASSETS_DIR / "fonts" / "his.ttf"
    icon_size = 16
    icon_font = ImageFont.truetype(str(font_path), icon_size)

    # Grid settings
    icon_spacing = 4
    icons_per_row = 6
    row_height = icon_size + icon_spacing

    # Calculate total rows and scrolling
    total_icons = len(all_icon_codes)
    total_rows = (total_icons + icons_per_row - 1) // icons_per_row
    rows_per_page = max(1, (context.height - content_top - 12) // row_height)
    max_offset = max(0, total_rows - rows_per_page)
    scroll_offset = 0

    def render(offset: int) -> int:
        offset = max(0, min(offset, max_offset))

        draw = context.draw
        draw.rectangle((0, 0, context.width, context.height), outline=0, fill=0)

        # Draw title with icon using proper function
        layout = display.draw_title_with_icon(
            title,
            title_font=title_font,
            icon=chr(0xE9A5),  # Heroicons sparkles icon
            extra_gap=1,
            left_margin=context.x - 11,
            draw=draw,
        )

        # Draw grid of icons
        start_row = offset
        end_row = min(total_rows, offset + rows_per_page)

        current_y = layout.content_top
        for row in range(start_row, end_row):
            start_idx = row * icons_per_row
            end_idx = min(total_icons, start_idx + icons_per_row)

            # Center the row horizontally
            icons_in_row = end_idx - start_idx
            row_width = icons_in_row * (icon_size + icon_spacing) - icon_spacing
            start_x = (context.width - row_width) // 2

            current_x = start_x
            for idx in range(start_idx, end_idx):
                icon_code = all_icon_codes[idx]
                glyph = chr(icon_code)
                draw.text((current_x, current_y), glyph, font=icon_font, fill=255)
                current_x += icon_size + icon_spacing

            current_y += row_height

        # Show scroll indicator and count
        if total_rows > rows_per_page:
            footer_text = f"▲▼ scroll • {total_icons} icons"
            footer_font = context.fontdisks
            footer_height = display._get_line_height(footer_font)
            footer_y = context.height - footer_height - 1
            footer_x = context.x - 11
            draw.text((footer_x, footer_y), footer_text, font=footer_font, fill=255)
        else:
            # Just show count
            footer_text = f"{total_icons} icons"
            footer_font = context.fontdisks
            footer_height = display._get_line_height(footer_font)
            footer_y = context.height - footer_height - 1
            footer_x = context.x - 11
            draw.text((footer_x, footer_y), footer_text, font=footer_font, fill=255)

        context.disp.display(context.image)
        return offset

    scroll_offset = render(scroll_offset)
    menus.wait_for_buttons_release(
        [gpio.PIN_A, gpio.PIN_B, gpio.PIN_L, gpio.PIN_R, gpio.PIN_U, gpio.PIN_D]
    )
    prev_states = {
        "A": gpio.read_button(gpio.PIN_A),
        "B": gpio.read_button(gpio.PIN_B),
        "L": gpio.read_button(gpio.PIN_L),
        "R": gpio.read_button(gpio.PIN_R),
        "U": gpio.read_button(gpio.PIN_U),
        "D": gpio.read_button(gpio.PIN_D),
    }
    while True:
        current_a = gpio.read_button(gpio.PIN_A)
        if prev_states["A"] and not current_a:
            return
        current_b = gpio.read_button(gpio.PIN_B)
        if prev_states["B"] and not current_b:
            return
        current_l = gpio.read_button(gpio.PIN_L)
        if prev_states["L"] and not current_l:
            return
        current_r = gpio.read_button(gpio.PIN_R)
        current_u = gpio.read_button(gpio.PIN_U)
        if prev_states["U"] and not current_u:
            scroll_offset = max(0, scroll_offset - 1)
            scroll_offset = render(scroll_offset)
        current_d = gpio.read_button(gpio.PIN_D)
        if prev_states["D"] and not current_d:
            scroll_offset = min(max_offset, scroll_offset + 1)
            scroll_offset = render(scroll_offset)
        prev_states["A"] = current_a
        prev_states["B"] = current_b
        prev_states["L"] = current_l
        prev_states["R"] = current_r
        prev_states["U"] = current_u
        prev_states["D"] = current_d
        time.sleep(0.05)


def _format_font_label(font_path: Path) -> str:
    return font_path.stem.replace("_", " ").replace("-", " ").upper()


def show_title_font_preview(title: str = "TITLE FONT PREVIEW") -> None:
    context = display.get_display_context()
    fonts_dir = display.ASSETS_DIR / "fonts"
    font_paths = sorted(
        [
            path
            for path in fonts_dir.glob("*")
            if path.suffix.lower() in {".ttf", ".otf"}
        ]
    )
    if not font_paths:
        display.display_lines([title, "No fonts found"])
        time.sleep(1.5)
        return

    reset_label = "RESET TO DEFAULT"
    items = [reset_label] + [_format_font_label(path) for path in font_paths]
    selected_index = 0
    default_size = getattr(context.fontcopy, "size", 16)

    while True:
        selection = menus.render_menu_list(title, items, selected_index=selected_index)
        if selection is None:
            return
        selected_index = selection
        if selection == 0:
            context.fonts["title"] = context.fontcopy
            display.display_lines([title, "Reset to default"])
            time.sleep(1)
            continue

        font_path = font_paths[selection - 1]
        try:
            preview_font = ImageFont.truetype(str(font_path), default_size)
        except Exception:
            display.display_lines([title, "Load failed"])
            time.sleep(1.5)
            continue
        context.fonts["title"] = preview_font
        display.display_lines([title, "Preview applied"])
        time.sleep(1)
