<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Raspberry Pi USB Cloner - Web Interface for managing USB drive cloning operations">
  <title>Rpi USB Cloner</title>

  <!-- Theme-aware SVG icons (modern browsers) -->
  <link rel="icon" href="/static/favicon/favicon.ico" sizes="any">
  <link rel="icon" href="/static/favicon/favicon-light.svg" type="image/svg+xml" media="(prefers-color-scheme: light)">
  <link rel="icon" href="/static/favicon/favicon-dark.svg" type="image/svg+xml" media="(prefers-color-scheme: dark)">

  <!-- Fallback PNG icons -->
  <link rel="apple-touch-icon" sizes="180x180" href="/static/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon/favicon-16x16.png">

  <!-- Theme color for mobile browsers -->
  <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#111115" media="(prefers-color-scheme: dark)">

  <link rel="stylesheet" href="/static/tabler/tabler.min.css" />
  <style>
    @font-face {
      font-family: 'Lucide';
      src: url('/ui-assets/fonts/lucide.ttf') format('truetype');
      font-display: swap;
    }
    .lucide-icon {
      font-family: 'Lucide';
      font-size: 1.1em;
      line-height: 1;
    }
    .lucide-icon::before {
      display: inline-block;
    }
    .lucide-icon-tv::before { content: "\e203"; }
    .lucide-icon-logs::before { content: "\e5f4"; }
    .lucide-icon-copy-plus::before { content: "\e3fd"; }
    .lucide-icon-activity::before { content: "\e038"; }
    .lucide-icon-cpu::before { content: "\e0a9"; }
    .lucide-icon-memory-stick::before { content: "\e445"; }
    .lucide-icon-hard-drive::before { content: "\e0ed"; }
    .lucide-icon-thermometer::before { content: "\e186"; }
    .lucide-icon-github::before { content: "\e0e6"; }
    .lucide-icon-sun::before { content: "\e178"; }
    .lucide-icon-moon::before { content: "\e11e"; }
    .lucide-icon-usb::before { content: "\e356"; }
    .lucide-icon-check-circle::before { content: "\e088"; }
    .lucide-icon-alert-circle::before { content: "\e045"; }
    .lucide-icon-disc::before { content: "\e0cb"; }
    .lucide-icon-folder::before { content: "\e0d7"; }

    /* Dark mode logo styling */
    [data-bs-theme="dark"] .navbar-brand img {
      filter: invert(1) brightness(1.2);
    }

    /* D-pad styling */
    .dpad-container {
      position: relative;
      width: 180px;
      height: 180px;
    }
    .dpad-svg {
      width: 100%;
      height: 100%;
      display: block;
    }
    .dpad-cross { fill: #000; }
    .dpad-arrow {
      fill: #fff;
      transition: fill 0.15s ease;
    }
    .dpad-container:has(.dpad-up:hover) .dpad-arrow-up { fill: #ff4d4f; }
    .dpad-container:has(.dpad-down:hover) .dpad-arrow-down { fill: #ff4d4f; }
    .dpad-container:has(.dpad-left:hover) .dpad-arrow-left { fill: #ff4d4f; }
    .dpad-container:has(.dpad-right:hover) .dpad-arrow-right { fill: #ff4d4f; }
    .dpad-btn {
      position: absolute;
      background: transparent;
      border: none;
      color: #fff;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
    }
    .dpad-btn:active { background: rgba(255, 77, 79, 0.2) !important; }
    .dpad-up { width: 60px; height: 70px; left: 60px; top: 0; }
    .dpad-down { width: 60px; height: 70px; left: 60px; bottom: 0; }
    .dpad-left { width: 70px; height: 60px; left: 0; top: 60px; }
    .dpad-right { width: 70px; height: 60px; right: 0; top: 60px; }

    /* Action buttons */
    .action-buttons {
      position: relative;
      width: 180px;
      height: 180px;
    }
    .btn-ok { position: absolute; top: 0; right: 0; }
    .btn-back { position: absolute; bottom: 0; left: 0; }
    .action-btn {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      border: none;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      padding: 0;
      background: transparent;
    }
    .action-btn svg { width: 100%; height: 100%; display: block; }
    .action-btn circle {
      fill: #000;
      transition: fill 0.15s ease, filter 0.15s ease;
    }
    .action-btn text {
      fill: #fff;
      font-family: Arial, sans-serif;
      font-size: 16px;
      font-weight: bold;
      letter-spacing: 0.5px;
      transition: fill 0.15s ease;
    }
    .action-btn:hover circle { fill: #000; }
    .action-btn:hover text { fill: #ff4d4f; }
    .action-btn:active circle { fill: #ff4d4f !important; }

    /* Responsive adjustments */
    @media (max-width: 575.98px) {
      .preview-controls { flex-wrap: nowrap; gap: 0.75rem; }
      .preview-controls .dpad-container,
      .preview-controls .action-buttons { width: 150px; height: 150px; }
      .preview-controls .action-btn { width: 75px; height: 75px; }
    }

    /* Canvas styling */
    #screen {
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      border: 10px solid black;
    }

    /* Scrollable areas */
    .scrollable { overflow-y: auto; }
  </style>
</head>
<body>
  <div class="page">
    <!-- Navbar -->
    <header class="navbar navbar-expand-md d-print-none">
      <div class="container-xl">
        <a class="navbar-brand d-flex align-items-center gap-2" href="#" aria-label="Rpi USB Cloner">
          <img src="/ui-assets/logos/logo.svg" alt="" aria-hidden="true" class="navbar-brand-image">
          <span class="fw-semibold">Rpi USB CLONER</span>
        </a>
        <div class="navbar-nav flex-row order-md-last ms-auto align-items-center">
          <div class="nav-item">
            <button class="nav-link d-flex align-items-center btn btn-link p-0 border-0" id="theme-toggle" aria-label="Toggle theme">
              <span class="lucide-icon lucide-icon-sun" id="theme-icon" aria-hidden="true"></span>
            </button>
          </div>
          <div class="nav-item">
            <a class="nav-link d-flex align-items-center" href="https://github.com/2wenty2wo/Rpi-USB-Cloner" target="_blank" rel="noopener noreferrer" aria-label="View on GitHub">
              <span class="lucide-icon lucide-icon-github" aria-hidden="true"></span>
            </a>
          </div>
          <div class="nav-item">
            <span class="nav-link d-flex align-items-center small" id="status">
              <span class="status status-red"><span class="status-dot"></span>Disconnected</span>
            </span>
          </div>
        </div>
      </div>
    </header>

    <!-- Main content -->
    <div class="page-wrapper">
      <div class="page-body">
        <div class="container-xl">
          
          <!-- System Health Card -->
          <div class="row row-cards mb-3">
            <div class="col-12">
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title fw-semibold fs-4 d-flex align-items-center gap-2">
                    <span class="lucide-icon lucide-icon-activity" aria-hidden="true"></span>
                    System Health
                  </h3>
                </div>
                <div class="card-body">
                  <div class="row g-3">
                    <!-- CPU -->
                    <div class="col-12 col-sm-6 col-lg-3">
                      <div class="mb-1 d-flex align-items-center justify-content-between">
                        <small class="text-muted d-flex align-items-center gap-1">
                          <span class="lucide-icon lucide-icon-cpu" aria-hidden="true"></span>
                          CPU Usage
                        </small>
                        <span id="cpu-percent" class="fw-bold">--</span>
                      </div>
                      <div class="progress progress-sm">
                        <div id="cpu-bar" class="progress-bar w-0" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                      </div>
                    </div>
                    <!-- Memory -->
                    <div class="col-12 col-sm-6 col-lg-3">
                      <div class="mb-1 d-flex align-items-center justify-content-between">
                        <small class="text-muted d-flex align-items-center gap-1">
                          <span class="lucide-icon lucide-icon-memory-stick" aria-hidden="true"></span>
                          Memory
                        </small>
                        <span id="memory-percent" class="fw-bold">--</span>
                      </div>
                      <div class="progress progress-sm">
                        <div id="memory-bar" class="progress-bar w-0" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                      </div>
                      <small id="memory-detail" class="text-secondary">-- / -- MB</small>
                    </div>
                    <!-- Disk -->
                    <div class="col-12 col-sm-6 col-lg-3">
                      <div class="mb-1 d-flex align-items-center justify-content-between">
                        <small class="text-muted d-flex align-items-center gap-1">
                          <span class="lucide-icon lucide-icon-hard-drive" aria-hidden="true"></span>
                          Disk Space
                        </small>
                        <span id="disk-percent" class="fw-bold">--</span>
                      </div>
                      <div class="progress progress-sm">
                        <div id="disk-bar" class="progress-bar w-0" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                      </div>
                      <small id="disk-detail" class="text-secondary">-- / -- GB</small>
                    </div>
                    <!-- Temperature -->
                    <div class="col-12 col-sm-6 col-lg-3">
                      <div class="mb-1 d-flex align-items-center justify-content-between">
                        <small class="text-muted d-flex align-items-center gap-1">
                          <span class="lucide-icon lucide-icon-thermometer" aria-hidden="true"></span>
                          Temperature
                        </small>
                        <span id="temp-value" class="fw-bold">--</span>
                      </div>
                      <div class="progress progress-sm">
                        <div id="temp-bar" class="progress-bar w-0" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                      </div>
                      <small id="temp-detail" class="text-secondary">Raspberry Pi</small>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Preview and Logs -->
          <div class="row row-cards mb-3">
            <!-- Preview Card -->
            <div class="col-12 col-lg-6">
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title fw-semibold fs-4 d-flex align-items-center gap-2">
                    <span class="lucide-icon lucide-icon-tv" aria-hidden="true"></span>
                    Preview
                  </h3>
                </div>
                <div class="card-body">
                  <div class="ratio ratio-2x1 mb-4">
                    <canvas id="screen" class="w-100 h-100 d-block" width="128" height="64"></canvas>
                  </div>
                  <div class="row g-4 align-items-center justify-content-between preview-controls">
                    <!-- D-pad -->
                    <div class="col-6 col-md-6 d-flex justify-content-center">
                      <div class="dpad-container">
                        <svg class="dpad-svg" viewBox="0 0 200 200" aria-hidden="true" focusable="false">
                          <path class="dpad-cross" d="M78 20h44a8 8 0 0 1 8 8v42h42a8 8 0 0 1 8 8v44a8 8 0 0 1-8 8h-42v42a8 8 0 0 1-8 8H78a8 8 0 0 1-8-8v-42H28a8 8 0 0 1-8-8V78a8 8 0 0 1 8-8h42V28a8 8 0 0 1 8-8z" />
                          <path class="dpad-arrow dpad-arrow-up" d="M100 38l12 20H88z" />
                          <path class="dpad-arrow dpad-arrow-down" d="M100 162l-12-20h24z" />
                          <path class="dpad-arrow dpad-arrow-left" d="M38 100l20-12v24z" />
                          <path class="dpad-arrow dpad-arrow-right" d="M162 100l-20 12V88z" />
                        </svg>
                        <button class="dpad-btn dpad-up" data-button="UP" aria-label="Up"></button>
                        <button class="dpad-btn dpad-down" data-button="DOWN" aria-label="Down"></button>
                        <button class="dpad-btn dpad-left" data-button="LEFT" aria-label="Left"></button>
                        <button class="dpad-btn dpad-right" data-button="RIGHT" aria-label="Right"></button>
                      </div>
                    </div>
                    <!-- Action buttons -->
                    <div class="col-6 col-md-6 d-flex justify-content-center">
                      <div class="action-buttons">
                        <button class="action-btn btn btn-circle btn-dark btn-back" data-button="BACK" aria-label="Back">
                          <svg viewBox="0 0 100 100" aria-hidden="true" focusable="false">
                            <circle cx="50" cy="50" r="46" />
                            <text x="50" y="56" text-anchor="middle">BACK</text>
                          </svg>
                        </button>
                        <button class="action-btn btn btn-circle btn-dark btn-ok" data-button="OK" aria-label="OK">
                          <svg viewBox="0 0 100 100" aria-hidden="true" focusable="false">
                            <circle cx="50" cy="50" r="46" />
                            <text x="50" y="56" text-anchor="middle">OK</text>
                          </svg>
                        </button>
                      </div>
                    </div>
                  </div>
                  <!-- Keyboard hint -->
                  <div class="text-center text-muted small mt-3">
                    <span class="me-2">↑↓←→ Navigate</span>
                    <span class="me-2">Enter/OK Confirm</span>
                    <span>Esc/Back</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Logs Card -->
            <div class="col-12 col-lg-6">
              <div class="card h-100 d-flex flex-column">
                <div class="card-header">
                  <h3 class="card-title fw-semibold fs-4 d-flex align-items-center gap-2">
                    <span class="lucide-icon lucide-icon-logs" aria-hidden="true"></span>
                    Logs
                  </h3>
                  <div class="card-actions">
                    <button type="button" class="btn btn-sm btn-outline-secondary" id="clear-logs-btn" title="Clear all logs">
                      Clear
                    </button>
                  </div>
                </div>
                <!-- Log Filters -->
                <div class="card-body pt-2 pb-1 border-bottom flex-grow-0 flex-shrink-0">
                  <div class="row g-2">
                    <div class="col-auto">
                      <select class="form-select form-select-sm" id="log-level-filter" title="Filter by log level">
                        <option value="all">All Levels</option>
                        <option value="trace">TRACE</option>
                        <option value="debug">DEBUG</option>
                        <option value="info">INFO</option>
                        <option value="success">SUCCESS</option>
                        <option value="warning">WARNING</option>
                        <option value="error">ERROR</option>
                        <option value="critical">CRITICAL</option>
                      </select>
                    </div>
                    <div class="col-auto">
                      <select class="form-select form-select-sm" id="log-source-filter" title="Filter by source">
                        <option value="all">All Sources</option>
                        <option value="system">System</option>
                        <option value="usb">USB</option>
                        <option value="clone">Clone</option>
                        <option value="web">Web</option>
                        <option value="gpio">GPIO</option>
                        <option value="menu">Menu</option>
                        <option value="clonezilla">Clonezilla</option>
                        <option value="app">APP</option>
                        <option value="ui">UI</option>
                      </select>
                    </div>
                    <div class="col">
                      <input type="text" class="form-control form-control-sm" id="log-search-input" placeholder="Search logs..." title="Search in log messages">
                    </div>
                  </div>
                </div>
                <!-- Log entries -->
                <div class="card-body p-0 d-flex" style="height: 18rem;">
                  <div id="debug-log" class="list-group list-group-flush w-100 h-100 scrollable"></div>
                </div>
                <!-- Footer -->
                <div class="card-footer d-flex align-items-center pt-4 mt-auto">
                  <label class="form-check form-switch m-0">
                    <input class="form-check-input" type="checkbox" id="auto-scroll-toggle" checked>
                    <span class="form-check-label">Auto-scroll</span>
                  </label>
                  <span class="text-secondary small ms-auto" id="log-count-display">0 logs</span>
                </div>
              </div>
            </div>
          </div>

          <!-- USB Devices and Image Repo -->
          <div class="row row-cards mb-3">
            <!-- USB Devices -->
            <div class="col-12 col-lg-6">
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title fw-semibold fs-4 d-flex align-items-center gap-2">
                    <span class="lucide-icon lucide-icon-usb" aria-hidden="true"></span>
                    USB Devices
                  </h3>
                  <div class="card-actions">
                    <span id="device-count" class="badge bg-secondary text-white">0 devices</span>
                  </div>
                </div>
                <div class="card-body">
                  <div id="usb-devices-container">
                    <div class="text-center text-muted py-4">
                      <span class="lucide-icon lucide-icon-usb" style="font-size: 2rem;" aria-hidden="true"></span>
                      <p class="mt-2">No USB devices detected</p>
                      <p class="text-secondary small">Connect a USB drive to get started</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Image Repo -->
            <div class="col-12 col-lg-6">
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title fw-semibold fs-4 d-flex align-items-center gap-2">
                    <span class="lucide-icon lucide-icon-folder" aria-hidden="true"></span>
                    Image Repo
                  </h3>
                  <div class="card-actions">
                    <span id="image-count" class="badge bg-secondary text-white">0 images</span>
                  </div>
                </div>
                <div class="card-body">
                  <!-- Storage chart -->
                  <div id="image-repo-chart" class="px-3 pt-3 pb-2 d-none">
                    <div class="progress progress-stacked" style="height: 0.75rem;">
                      <div class="progress-bar bg-primary" role="progressbar" style="width: 0%;" aria-label="Clonezilla usage" data-repo-segment="clonezilla"></div>
                      <div class="progress-bar bg-info" role="progressbar" style="width: 0%;" aria-label="ISO usage" data-repo-segment="iso"></div>
                      <div class="progress-bar bg-warning" role="progressbar" style="width: 0%;" aria-label="BIN usage" data-repo-segment="imageusb"></div>
                      <div class="progress-bar bg-secondary" role="progressbar" style="width: 0%;" aria-label="Other usage" data-repo-segment="other"></div>
                      <div class="progress-bar bg-secondary-lt" role="progressbar" style="width: 0%;" aria-label="Free space" data-repo-segment="free"></div>
                    </div>
                    <div id="image-repo-chart-legend" class="d-flex flex-wrap gap-2 mt-3"></div>
                    <div id="image-repo-divider" class="hr my-3 d-none"></div>
                  </div>
                  <!-- Image list -->
                  <div id="image-repo-container">
                    <div class="text-center text-muted py-4">
                      <span class="lucide-icon lucide-icon-folder" style="font-size: 2rem;" aria-hidden="true"></span>
                      <p class="mt-2">No image repos detected</p>
                      <p class="text-secondary small">Connect a repo drive to browse available images</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="/static/apexcharts/apexcharts.min.js"></script>
  <script src="/static/tabler/tabler.min.js"></script>
  <script src="/static/js/theme.js"></script>
  <script src="/static/js/websocket.js"></script>
  <script src="/static/js/logs.js"></script>
  <script src="/static/js/health.js"></script>
  <script src="/static/js/devices.js"></script>
  <script src="/static/js/screen.js"></script>
  <script src="/static/js/app.js"></script>
</body>
</html>
